#!/bin/bash

# Output CSV file
output_file="pokemon_report.csv"
echo "CSV Report generated at: $output_file"

# CSV header
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Process files and collect data for averages
awk -v csv="$output_file" '
BEGIN {
    FS = ",";
    total_h = 0;
    total_w = 0;
    count = 0;
    # Print header to CSV
    print "Name,Height (m),Weight (kg)" > csv
}
{
    # Process each JSON file passed as argument
    while ((getline line < $0) > 0) {
        if (line ~ /"name":/) {
            split(line, a, "\"");
            name = a[4];
            # Capitalize first letter
            name = toupper(substr(name,1,1)) substr(name,2);
        }
        else if (line ~ /"height":/) {
            split(line, a, ":");
            height = a[2];
            gsub(/[^0-9]/, "", height);
            height = height/10;
        }
        else if (line ~ /"weight":/) {
            split(line, a, ":");
            weight = a[2];
            gsub(/[^0-9]/, "", weight);
            weight = weight/10;
        }
    }
    close($0);
    
    # Add to CSV
    print name "," height "," weight >> csv;
    
    # Accumulate for averages
    total_h += height;
    total_w += weight;
    count++;
}
END {
    # Calculate and print averages
    printf "\nAverage Height: %.2f m\n", total_h/count;
    printf "Average Weight: %.2f kg\n", total_w/count;
}
' pokemon_data/*.json

# Display the CSV file
cat "$output_file"

