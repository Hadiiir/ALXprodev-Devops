#!/bin/bash

# Output CSV file
output_file="pokemon_report.csv"
echo "CSV Report generated at: $output_file"

# CSV header
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Initialize temp file for awk processing
temp_file=$(mktemp)

# Process each JSON file
for file in pokemon_data/*.json; do
    # Extract data using jq and format with awk
    jq -r '[
        .name | ascii_upcase[:1] + .[1:],
        (.height/10 | tostring),
        (.weight/10 | tostring)
    ] | join(",")' "$file" >> "$temp_file"
done

# Sort the data and add to CSV
sort "$temp_file" >> "$output_file"

# Calculate averages using awk
awk -F, '
    {
        total_h += $2; 
        total_w += $3; 
        count++
    } 
    END {
        printf "\nAverage Height: %.2f m\n", total_h/count; 
        printf "Average Weight: %.2f kg\n", total_w/count
    }
' "$temp_file"

# Clean up
rm "$temp_file"

# Display the CSV file
cat "$output_file"

